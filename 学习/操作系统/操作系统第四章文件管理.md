# 文件管理
## 1.文件系统基础
### 1.1文件的定义
文件是以计算机硬盘为载体存储在计算机上的信息集合。 在系统运行时，计算机以进程为基本单位进行资源的调度和分配。**而在用户进行输入输出时，则以文件为基本单位**。同时用户希望对文件进行各种各样的维护管理，因此就出现了**文件系统**。
### 1.2文件的属性
一般有名称、标识符、类型、位置、大小、保护、时间、日期、用户标识等。
### 1.3文件基本操作
创建、写、读、重定位、删除、截断。
### 1.4文件的逻辑结构【重要】
主要分为：
+ 无结构文件（流式文件）
  
  无结构文件是最简单的文件组织方式。无结构文件将数据按顺序组织成记录并积累保存，它是有序相关信息的集合，**以字节为单位**。由于没有结构，对记录的访问只能以穷举搜索的方式。

+ 有结构文件（按照记录的组织方式分类）
  + 顺序文件
    
    文件中的记录一个接一个地顺序排列，记录通常是定长的，可以顺序存储或以链表的方式存储，在访问时顺序搜索文件。顺序文件有以下两种结构：
    + 串结构：记录之间的顺序通常由存入时间决定。
    + 顺序结构：记录按照关键字顺序排列。
    
    顺序文件的优点：批量操作时在所有逻辑结构中效率最高。
    
    顺序文件的缺点：查找、修改、删除单个记录困难。

  + 索引文件

    对于定长记录文件要查找第i个记录时
    > Address_i = i * length

    对于可变长记录文件
    > Address_i = sigema(0~i-1) + i

    对于可变长记录文件只能顺序查找，开销较大，因此可以建立索引。其中索引表本身是定长记录文件（书本P213）。

  + 索引顺序文件

    将顺序文件分为若干组，为每组第一个记录建立索引。**查找次数为根号N次**。
  + 直接文件或散列文件

    对于给定记录的键值，根据散列函数直接计算物理地址，**没有顺序的特性**。
### 1.5目录结构
特点：按名存取
#### 1.5.1文件控制块和索引节点
+ 文件控制块

  与进程管理一样，为实现目录管理，引入了**文件控制块**的数据结构。

  文件控制块（FCB）主要包含以下信息：
  + 基本信息：如文件名、文件物理位置、文件逻辑结构、文件物理结构等。
  + 存取控制信息：存取权限等。
  + 使用信息：建立时间、修改时间等。
+ **索引节点**
  
  在检索目录文件的过程中，只用到了文件名，仅当匹配到了同名的目录项时才读取该文件的物理地址。也就是说，在检索目录时只用到了文件名，其他的信息不会使用也不会调入内存。因此，如UNIX等系统把文件名和文件描述信息分开，文件描述信息单独形成一个**索引节点**，文件目录的目录项只由文件名和指向对应索引节点的指针构成。
#### 1.5.2目录结构
我们先来看看一个目录有哪些操作：
+ 搜索
+ 创建文件
+ 删除文件
+ 显示目录
+ 修改目录

操作时，考虑一下几种目录结构：
1. 单级目录结构：只建立一张目录表，每个文件占一个目录项。缺点：查找速度慢、文件不允许重名、对多用户OS不友好。
2. 两级目录结构：将文件目录分为主文件目录（MFD）和用户文件目录（UFD）。主文件目录记录用户名等信息。
3. 多级目录结构：从根目录出发的路径称为绝对路径，文件名由'/'分隔。
4. 无环图目录结构：形成一个有向无环图，有利于文件共享，当一个用户删除文件时只删除对应的边，当所有的边都删掉的时候才删除该文件（类比python的垃圾处理机制）。
### 1.6文件共享
现代常用的两种文件共享方法有：
+ 基于索引节节点的共享方式（硬链接）：和上面的无环图目录结构相似，王道考研P218。
+ 利用符号链实现文件共享（软链接）：略。P218。
### 1.7文件保护
文件保护通过**口令保护、加密保护、访问控制**等方式实现。其中前两者是防止文件被他人存取或窃取，后者用于控制用户对文件的访问方式。
+ 访问类型：保护可以从限制文件的访问类型出发，访问类型有如下几种：读、写、执行、添加、删除、列表清单（列出文件的名字和属性）。
+ 访问控制：最常用的方法是根据用户身份进行控制。例如：为每个文件增加一个访问控制列表（Access-Control List，ACL），以规定每个用户所允许的访问类型。

  一个精简ACL是：1.拥有者（创建者）2.组（可以共享文件的用户）3.其他（系统内的其他用户）。